<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Solar 3D & Mapa Mundi</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Estilo do Menu Principal */
        #main-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10; color: white;
        }
        h1 { font-size: 3rem; text-transform: uppercase; letter-spacing: 5px; margin-bottom: 40px; text-shadow: 0 0 10px #4facfe; }
        
        .btn {
            padding: 15px 40px; margin: 10px; font-size: 1.5rem;
            background: transparent; color: white; border: 2px solid #4facfe;
            cursor: pointer; transition: 0.3s; border-radius: 30px; text-transform: uppercase;
            width: 300px;
        }
        .btn:hover { background: #4facfe; color: #000; box-shadow: 0 0 20px #4facfe; }

        /* Botões Flutuantes (Voltar e Pausar) */
        #controls-container {
            position: absolute; top: 20px; left: 20px; z-index: 5;
            display: none;
        }
        #back-btn, #pause-btn {
            padding: 10px 20px; margin-right: 10px;
            background: rgba(255, 0, 0, 0.7);
            color: white; border: none; cursor: pointer; 
            font-size: 1rem; border-radius: 5px;
        }
        #pause-btn {
            background: rgba(0, 150, 255, 0.7);
        }
        
        /* Info dos Planetas */
        #planet-info {
            position: absolute; bottom: 20px; left: 20px;
            background: rgba(0, 0, 0, 0.7); color: white;
            padding: 15px; border-radius: 10px; max-width: 300px;
            display: none; z-index: 5;
        }
    </style>
</head>
<body>

    <audio id="ambient-music" loop muted preload="auto"></audio>
    
    <div id="main-menu">
        <h1>Cosmos Explorer</h1>
        <button class="btn" onclick="iniciarJogo('solar')">Jogar (Sistema Solar)</button>
        <button class="btn" onclick="iniciarJogo('mapa')">Mapa Mundi</button>
    </div>

    <div id="controls-container">
        <button id="back-btn" onclick="voltarMenu()">Voltar ao Menu</button>
        <button id="pause-btn" onclick="togglePause()">Pausar Rotação</button>
    </div>
    
    <div id="planet-info"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls;
        let animationId;
        let planets = []; 
        let audio; 
        let isPaused = false;
        let raycaster, mouse;
        let currentHoveredPlanet = null;
        
        // --- CONFIGURAÇÃO DE CAMINHOS E ESCALAS ---
        const REPO_NAME = 'Solar-System'; 
        
        // ESFERA DE ESTRELAS: Aumentada em 99% (quase o dobro)
        const STAR_SPHERE_RADIUS = 10000; // 5000 + 99% ≈ 9950, arredondado para 10000
        const MAX_CAMERA_DISTANCE = 9000; // 4500 + 99% ≈ 8955, arredondado para 9000
        
        // ESCALA DO SISTEMA SOLAR - VISUALMENTE BALANCEADA
        // Base: Terra = 1.0 unidade de raio visual
        const PLANET_SIZES = {
            sun: 25,        // Sol reduzido (real seria 109 vezes Terra)
            mercury: 0.4,   // Aumentado para ser visível
            venus: 0.95,    // Quase igual à Terra
            earth: 1.0,     // Referência
            moon: 0.27,     // Em relação à Terra
            mars: 0.5,      // Aumentado para visibilidade
            jupiter: 8,     // Gigante, mas não enorme demais
            saturn: 7,      // Um pouco menor que Júpiter
            uranus: 4,      // Bem menor que os gigantes gasosos
            neptune: 4      // Similar a Urano
        };
        
        // DISTÂNCIAS DO SOL - COMPACTADAS MAS PROPORCIONAIS
        // 1 unidade = ~1.000.000 km aproximado
        const PLANET_DISTANCES = {
            mercury: 60,    // Real: 58 milhões km
            venus: 100,     // Real: 108 milhões km  
            earth: 150,     // Real: 150 milhões km (1 UA)
            mars: 230,      // Real: 228 milhões km
            jupiter: 450,   // Real: 778 milhões km
            saturn: 800,    // Real: 1.4 bilhões km
            uranus: 1300,   // Real: 2.9 bilhões km
            neptune: 1900   // Real: 4.5 bilhões km
        };
        
        // INFORMAÇÕES DOS PLANETAS
        const PLANET_INFO = {
            sun: { name: "Sol", type: "Estrela", diameter: "1.392.700 km", facts: "Estrela anã amarela que fornece energia para todo o Sistema Solar" },
            mercury: { name: "Mercúrio", type: "Planeta Rochoso", diameter: "4.879 km", facts: "O menor planeta e mais próximo do Sol" },
            venus: { name: "Vênus", type: "Planeta Rochoso", diameter: "12.104 km", facts: "O planeta mais quente devido ao efeito estufa intenso" },
            earth: { name: "Terra", type: "Planeta Rochoso", diameter: "12.742 km", facts: "Único planeta conhecido com vida" },
            moon: { name: "Lua", type: "Satélite Natural", diameter: "3.474 km", facts: "Satélite natural da Terra" },
            mars: { name: "Marte", type: "Planeta Rochoso", diameter: "6.779 km", facts: "Conhecido como 'Planeta Vermelho'" },
            jupiter: { name: "Júpiter", type: "Planeta Gasoso", diameter: "139.820 km", facts: "O maior planeta do Sistema Solar" },
            saturn: { name: "Saturno", type: "Planeta Gasoso", diameter: "116.460 km", facts: "Conhecido por seus anéis brilhantes" },
            uranus: { name: "Urano", type: "Planeta Gasoso", diameter: "50.724 km", facts: "Planeta que gira de lado" },
            neptune: { name: "Netuno", type: "Planeta Gasoso", diameter: "49.244 km", facts: "O planeta mais ventoso" }
        };
        
        // VELOCIDADES DE ÓRBITA (proporcionais à distância real)
        const ORBIT_SPEEDS = {
            mercury: 0.04,    // Mais rápido (mais próximo do Sol)
            venus: 0.015,     // Mais lento que Mercúrio
            earth: 0.01,      // 1 ano = 365 dias
            mars: 0.008,      // Mais lento que Terra
            jupiter: 0.002,   // Muito mais lento
            saturn: 0.0009,   // Mais lento ainda
            uranus: 0.0004,   // Muito lento
            neptune: 0.0001   // Mais lento de todos
        };
        
        // Fator de escala visual para planetas (tamanho na tela)
        const VISUAL_SCALE = 15; // Reduzido para ficar mais proporcional

        function buildPath(folder) {
            const isGitHubPages = window.location.host.includes('github.io');
            if (isGitHubPages) {
                return `/${REPO_NAME}/${folder}/`;
            } else {
                return `./${folder}/`;
            }
        }

        const texturePath = buildPath('textures'); 
        const AUDIO_FILE_PATH = buildPath('audio') + 'space_ambient.mp3'; 
        
        const textureLoader = new THREE.TextureLoader();

        const textureFiles = {
            stars: 'stars.jpg', sun: 'sun.jpg', mercury: 'mercury.jpg', venus: 'venus.jpg',
            earth: 'earth.jpg', moon: 'moon.jpg', mars: 'mars.jpg', jupiter: 'jupiter.jpg',
            saturn: 'saturn.jpg', uranus: 'uranus.jpg', neptune: 'neptune.jpg',
            worldMap: 'world_map_political.jpg',
            saturn_ring: 'saturn_ring.png' // Adicionar textura para anéis
        };

        function loadTexture(name) {
            const path = texturePath + textureFiles[name];
            return textureLoader.load(
                path, 
                undefined, 
                undefined, 
                (err) => {
                    console.warn(`Textura ${name} não encontrada em ${path}. Usando cor padrão.`);
                    // Retorna material básico se textura não existir
                    return new THREE.Color(0x888888);
                }
            );
        }

        function init() {
            const container = document.body;
            scene = new THREE.Scene();

            // Camera com far clip adequado para nova esfera maior
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 12000); 
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            
            // Habilita sombras
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap; 

            // Controles da câmera
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 5; 
            controls.maxDistance = MAX_CAMERA_DISTANCE;
            
            // Raycaster para detecção de hover
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Eventos de mouse
            window.addEventListener('mousemove', onMouseMove);
            
            audio = document.getElementById('ambient-music');
            audio.src = AUDIO_FILE_PATH;

            window.addEventListener('resize', onWindowResize);
        }

        function onMouseMove(event) {
            // Calcula posição do mouse normalizada
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            updateRaycaster();
        }
        
        function updateRaycaster() {
            if (!raycaster || !camera || planets.length === 0) return;
            
            // Atualiza raycaster
            raycaster.setFromCamera(mouse, camera);
            
            // Procura intersecções com planetas
            const intersects = raycaster.intersectObjects(
                planets.map(p => p.mesh).filter(mesh => mesh !== null)
            );
            
            if (intersects.length > 0) {
                const planetMesh = intersects[0].object;
                const planetData = planets.find(p => p.mesh === planetMesh);
                
                if (planetData && planetData.name !== currentHoveredPlanet) {
                    currentHoveredPlanet = planetData.name;
                    showPlanetInfo(planetData.name);
                    
                    // Destacar planeta (aumentar um pouco)
                    planetMesh.scale.setScalar(1.05);
                }
            } else {
                if (currentHoveredPlanet) {
                    currentHoveredPlanet = null;
                    hidePlanetInfo();
                    
                    // Resetar escala de todos os planetas
                    planets.forEach(p => {
                        p.mesh.scale.setScalar(1.0);
                    });
                }
            }
        }
        
        function showPlanetInfo(planetName) {
            const info = PLANET_INFO[planetName];
            if (info) {
                document.getElementById('planet-info').style.display = 'block';
                document.getElementById('planet-info').innerHTML = `
                    <h3>${info.name}</h3>
                    <p><strong>Tipo:</strong> ${info.type}</p>
                    <p><strong>Diâmetro:</strong> ${info.diameter}</p>
                    <p><em>${info.facts}</em></p>
                `;
            }
        }
        
        function hidePlanetInfo() {
            document.getElementById('planet-info').style.display = 'none';
        }

        // --- FUNÇÃO PARA LIMITAR CÂMERA ---
        function limitCameraPosition() {
            const distance = camera.position.length();
            
            if (distance > MAX_CAMERA_DISTANCE) {
                const direction = camera.position.clone().normalize();
                camera.position.copy(direction.multiplyScalar(MAX_CAMERA_DISTANCE));
                controls.update();
            }
        }

        // --- FUNÇÕES DE CONTROLE ---
        window.togglePause = function() {
            isPaused = !isPaused;
            const button = document.getElementById('pause-btn');
            button.textContent = isPaused ? 'Continuar Rotação' : 'Pausar Rotação';
        }

        function toggleAudio(play) {
            if (!audio) return;
            if (play) {
                audio.muted = false; 
                audio.volume = 0.3;
                audio.play().catch(e => console.error("Áudio não disponível. Verifique o caminho.", e));
            } else {
                audio.pause();
            }
        }

        // --- MODO 1: SISTEMA SOLAR CORRETO ---
        function createSolarSystem() {
            // Posição inicial da câmera
            camera.position.set(0, 300, 800); 
            
            // ESFERA DE ESTRELAS (10000 unidades de raio - 99% maior)
            const starGeo = new THREE.SphereGeometry(STAR_SPHERE_RADIUS, 64, 64);
            const starMat = new THREE.MeshBasicMaterial({ 
                map: loadTexture('stars'), 
                side: THREE.BackSide 
            });
            const starSphere = new THREE.Mesh(starGeo, starMat);
            scene.add(starSphere);

            // SOL - Centro do Sistema
            const sunGeo = new THREE.SphereGeometry(PLANET_SIZES.sun * VISUAL_SCALE, 64, 64);
            const sunMat = new THREE.MeshBasicMaterial({ 
                map: loadTexture('sun'),
                emissive: 0xff6600,
                emissiveIntensity: 0.8
            });
            const sun = new THREE.Mesh(sunGeo, sunMat);
            sun.name = "sun";
            scene.add(sun);
            
            // LUZ DO SOL
            const sunLight = new THREE.PointLight(0xffffff, 1.5, 20000); 
            sunLight.position.set(0, 0, 0); 
            sunLight.castShadow = true; 
            sunLight.shadow.mapSize.width = 2048; 
            sunLight.shadow.mapSize.height = 2048; 
            sunLight.shadow.camera.near = 0.5;
            sunLight.shadow.camera.far = 5000;
            scene.add(sunLight);
            
            // Luz ambiente muito suave
            const ambientLight = new THREE.AmbientLight(0x111111); 
            scene.add(ambientLight);

            // ORDEM CORRETA DOS PLANETAS
            const planetOrder = ['mercury', 'venus', 'earth', 'mars', 'jupiter', 'saturn', 'uranus', 'neptune'];
            
            planetOrder.forEach(planetName => {
                const size = PLANET_SIZES[planetName] * VISUAL_SCALE;
                const distance = PLANET_DISTANCES[planetName];
                const speed = ORBIT_SPEEDS[planetName];
                
                // Geometria do planeta
                const geo = new THREE.SphereGeometry(size, 64, 64);
                const mat = new THREE.MeshStandardMaterial({ 
                    map: loadTexture(planetName),
                    roughness: 0.8,
                    metalness: 0.2
                });
                const mesh = new THREE.Mesh(geo, mat);
                mesh.name = planetName;
                
                // Sombras
                mesh.receiveShadow = true;
                mesh.castShadow = true; 
                
                // Pivot para órbita
                const pivot = new THREE.Object3D();
                pivot.add(mesh);
                scene.add(pivot);
                mesh.position.x = distance;

                // LUA DA TERRA (apenas para Terra)
                if (planetName === 'earth') {
                    const moonSize = PLANET_SIZES.moon * VISUAL_SCALE;
                    const moonDistance = size * 2.5; // Distância proporcional
                    
                    const moonGeo = new THREE.SphereGeometry(moonSize, 32, 32); 
                    const moonMat = new THREE.MeshStandardMaterial({ 
                        map: loadTexture('moon'),
                        roughness: 0.9
                    });
                    const moonMesh = new THREE.Mesh(moonGeo, moonMat);
                    moonMesh.name = "moon";
                    
                    moonMesh.receiveShadow = true;
                    moonMesh.castShadow = true; 

                    // Pivot para órbita da Lua
                    const moonOrbitPivot = new THREE.Object3D();
                    moonOrbitPivot.position.x = distance;
                    
                    // Lua posicionada na distância correta
                    moonMesh.position.x = moonDistance;
                    
                    // Adiciona à cena
                    pivot.add(moonOrbitPivot); 
                    moonOrbitPivot.add(moonMesh);
                    
                    // Armazena dados da Lua
                    planets.push({ 
                        name: "moon",
                        mesh: moonMesh, 
                        pivot: moonOrbitPivot, 
                        orbitSpeed: speed * 13, // Lua orbita mais rápido
                        rotationSpeed: 0.005,
                        size: moonSize,
                        distance: moonDistance
                    });
                }
                
                // ANÉIS DE SATURNO
                if (planetName === 'saturn') {
                    createPlanetRings(mesh, size);
                }
                
                // Armazena dados do planeta
                planets.push({ 
                    name: planetName,
                    mesh: mesh, 
                    pivot: pivot, 
                    orbitSpeed: speed,
                    rotationSpeed: 0.005 + (Math.random() * 0.01), // Rotação única para cada
                    size: size,
                    distance: distance
                });
            });
        }
        
        function createPlanetRings(planetMesh, planetSize) {
            // Anéis internos
            const innerRingGeo = new THREE.RingGeometry(planetSize * 1.5, planetSize * 2.2, 64);
            const innerRingMat = new THREE.MeshBasicMaterial({
                color: 0xDAA520,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.7
            });
            const innerRing = new THREE.Mesh(innerRingGeo, innerRingMat);
            innerRing.rotation.x = Math.PI / 2;
            planetMesh.add(innerRing);
            
            // Anéis externos
            const outerRingGeo = new THREE.RingGeometry(planetSize * 2.3, planetSize * 3.0, 64);
            const outerRingMat = new THREE.MeshBasicMaterial({
                color: 0xCD853F,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.5
            });
            const outerRing = new THREE.Mesh(outerRingGeo, outerRingMat);
            outerRing.rotation.x = Math.PI / 2;
            planetMesh.add(outerRing);
        }

        // --- MODO 2: MAPA MUNDI ---
        function createWorldMap() {
            camera.position.set(0, 0, 25);
            
            const dirLight = new THREE.DirectionalLight(0xffffff, 3); 
            dirLight.position.set(10, 10, 10);
            scene.add(dirLight);

            const ambientLight = new THREE.AmbientLight(0x666666); 
            scene.add(ambientLight);

            // Globo Terrestre
            const geo = new THREE.SphereGeometry(10, 64, 64);
            const mat = new THREE.MeshStandardMaterial({ 
                map: loadTexture('worldMap'),
                roughness: 0.7, 
                metalness: 0.1 
            });
            const earth = new THREE.Mesh(geo, mat);
            earth.receiveShadow = true;
            earth.castShadow = true; 
            earth.name = "earth";
            scene.add(earth);

            // Rotação automática
            planets.push({ 
                name: "earth",
                mesh: earth, 
                pivot: null, 
                orbitSpeed: 0,
                rotationSpeed: 0.002,
                size: 10,
                distance: 0
            });
            
            // Ajusta limites da câmera
            controls.maxDistance = 50;
            controls.minDistance = 5;
        }

        // Loop de Animação
        function animate() {
            animationId = requestAnimationFrame(animate);
            controls.update();

            // Aplica limite de câmera
            limitCameraPosition();

            if (!isPaused) {
                planets.forEach(p => {
                    // Rotação do planeta/mapa
                    if (p.rotationSpeed) {
                        p.mesh.rotation.y += p.rotationSpeed;
                    }
                    
                    // Órbita ao redor do Sol
                    if (p.pivot && p.orbitSpeed) {
                        p.pivot.rotation.y += p.orbitSpeed;
                    }
                });
            }

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- LÓGICA DO MENU ---
        window.iniciarJogo = function(modo) {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('controls-container').style.display = 'flex';
            document.getElementById('planet-info').style.display = 'none';
            isPaused = false;
            document.getElementById('pause-btn').textContent = 'Pausar Rotação';

            if (!renderer) init();

            // Limpar cena
            while(scene.children.length > 0){ 
                scene.remove(scene.children[0]); 
            }
            planets = [];
            currentHoveredPlanet = null;

            if (modo === 'solar') {
                createSolarSystem();
                controls.maxDistance = MAX_CAMERA_DISTANCE;
                controls.minDistance = 5;
            } else {
                createWorldMap();
                controls.maxDistance = 50;
                controls.minDistance = 5;
            }
            
            controls.update();
            
            toggleAudio(true); 
            animate();
        };

        window.voltarMenu = function() {
            cancelAnimationFrame(animationId);
            document.getElementById('main-menu').style.display = 'flex';
            document.getElementById('controls-container').style.display = 'none';
            document.getElementById('planet-info').style.display = 'none';
            
            toggleAudio(false); 
            
            if (controls) {
                controls.reset();
            }
        }
        
        // Inicializar quando a página carregar
        window.addEventListener('DOMContentLoaded', () => {
            // Pré-carregar texturas
            Object.keys(textureFiles).forEach(key => {
                textureLoader.load(texturePath + textureFiles[key]);
            });
        });
    </script>
</body>
    </html>
