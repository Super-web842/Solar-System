<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Solar 3D & Mapa Mundi</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Estilo do Menu Principal */
        #main-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10; color: white;
        }
        h1 { font-size: 3rem; text-transform: uppercase; letter-spacing: 5px; margin-bottom: 40px; text-shadow: 0 0 10px #4facfe; }
        
        .btn {
            padding: 15px 40px; margin: 10px; font-size: 1.5rem;
            background: transparent; color: white; border: 2px solid #4facfe;
            cursor: pointer; transition: 0.3s; border-radius: 30px; text-transform: uppercase;
            width: 300px;
        }
        .btn:hover { background: #4facfe; color: #000; box-shadow: 0 0 20px #4facfe; }

        /* Botões Flutuantes (Voltar e Pausar) */
        #controls-container {
            position: absolute; top: 20px; left: 20px; z-index: 5;
            display: none;
        }
        #back-btn, #pause-btn {
            padding: 10px 20px; margin-right: 10px;
            background: rgba(255, 0, 0, 0.7);
            color: white; border: none; cursor: pointer; 
            font-size: 1rem; border-radius: 5px;
        }
        #pause-btn {
            background: rgba(0, 150, 255, 0.7);
        }
    </style>
</head>
<body>

    <audio id="ambient-music" loop muted></audio>
    
    <div id="main-menu">
        <h1>Cosmos Explorer</h1>
        <button class="btn" onclick="iniciarJogo('solar')">Jogar (Sistema Solar)</button>
        <button class="btn" onclick="iniciarJogo('mapa')">Mapa Mundi</button>
    </div>

    <div id="controls-container">
        <button id="back-btn" onclick="voltarMenu()">Voltar ao Menu</button>
        <button id="pause-btn" onclick="togglePause()">Pausar Rotação</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls;
        let animationId;
        let planets = []; 
        let audio; 
        let isPaused = false; 
        
        // --- CONFIGURAÇÃO DE CAMINHOS E TAMANHO DA ESFERA ---
        const REPO_NAME = 'Solar-System'; 
        const STAR_SPHERE_RADIUS = 10000; // NOVO: Aumentado para garantir cobertura total
        
        function buildPath(folder) {
            const isGitHubPages = window.location.host.includes('github.io');
            if (isGitHubPages) {
                return `/${REPO_NAME}/${folder}/`;
            } else {
                return `./${folder}/`;
            }
        }

        const texturePath = buildPath('textures'); 
        const AUDIO_FILE_PATH = buildPath('audio') + 'space_ambient.mp3'; 
        
        const textureLoader = new THREE.TextureLoader();

        const textureFiles = {
            stars: 'stars.jpg', sun: 'sun.jpg', mercury: 'mercury.jpg', venus: 'venus.jpg',
            earth: 'earth.jpg', moon: 'moon.jpg', mars: 'mars.jpg', jupiter: 'jupiter.jpg',
            saturn: 'saturn.jpg', uranus: 'uranus.jpg', neptune: 'neptune.jpg',
            worldMap: 'world_map_political.jpg' 
        };

        function loadTexture(name) {
            return textureLoader.load(
                texturePath + textureFiles[name], 
                undefined, 
                undefined, 
                (err) => console.warn(`Textura ${name} não encontrada em ${texturePath}${textureFiles[name]}. Usando cor padrão.`)
            );
        }

        function init() {
            const container = document.body;
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 10000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            
            // NOVO: Limita o zoom MÁXIMO (afastamento) com base no novo raio de 10000
            controls.maxDistance = STAR_SPHERE_RADIUS - 100; 
            controls.minDistance = 1; // Permite zoom bem perto do Sol

            audio = document.getElementById('ambient-music');
            audio.src = AUDIO_FILE_PATH;

            window.addEventListener('resize', onWindowResize);
        }

        // --- FUNÇÕES DE CONTROLE (Pausa e Áudio) ---
        window.togglePause = function() {
            isPaused = !isPaused;
            const button = document.getElementById('pause-btn');
            button.textContent = isPaused ? 'Continuar Rotação' : 'Pausar Rotação';
        }

        function toggleAudio(play) {
            if (!audio) return;
            if (play) {
                audio.muted = false; 
                audio.volume = 0.4;
                audio.play().catch(e => console.error("Não foi possível tocar o áudio.", e));
            } else {
                audio.pause();
            }
        }

        // --- MODO 1: SISTEMA SOLAR ---
        function createSolarSystem() {
            // Câmera posicionada para ver o sistema inteiro na nova escala
            camera.position.set(0, 100, 250); 
            
            // Background (com o novo raio de 10000)
            const starGeo = new THREE.SphereGeometry(STAR_SPHERE_RADIUS, 64, 64);
            const starMat = new THREE.MeshBasicMaterial({ map: loadTexture('stars'), side: THREE.BackSide });
            scene.add(new THREE.Mesh(starGeo, starMat));

            // Sol (Corpo emissor de luz)
            const sunGeo = new THREE.SphereGeometry(30, 64, 64);
            const sunMat = new THREE.MeshBasicMaterial({ map: loadTexture('sun') });
            const sun = new THREE.Mesh(sunGeo, sunMat);
            scene.add(sun);
            
            // LUZ BRANCA DO SOL
            const sunLight = new THREE.PointLight(0xFFFFFF, 500, STAR_SPHERE_RADIUS * 2); 
            sunLight.position.set(0, 0, 0); 
            scene.add(sunLight);
            
            // Luz Ambiente (MUITO fraca)
            const ambientLight = new THREE.AmbientLight(0x050505); 
            scene.add(ambientLight);

            // Dados dos planetas (Escala ULTRA COMPACTA - Netuno a 250 unidades)
            const planetData = [
                { size: 0.5, dist: 30, speed: 0.04, tex: 'mercury', hasMoon: false }, 
                { size: 0.8, dist: 50, speed: 0.015, tex: 'venus', hasMoon: false },  
                { size: 1.0, dist: 70, speed: 0.01, tex: 'earth', hasMoon: true },   
                { size: 0.7, dist: 90, speed: 0.008, tex: 'mars', hasMoon: false },  
                { size: 5.0, dist: 130, speed: 0.002, tex: 'jupiter', hasMoon: false }, 
                { size: 4.5, dist: 170, speed: 0.0009, tex: 'saturn', hasMoon: false }, 
                { size: 2.5, dist: 210, speed: 0.0004, tex: 'uranus', hasMoon: false }, 
                { size: 2.5, dist: 250, speed: 0.0001, tex: 'neptune', hasMoon: false } 
            ];

            planetData.forEach(data => {
                const geo = new THREE.SphereGeometry(data.size, 64, 64);
                const mat = new THREE.MeshStandardMaterial({ 
                    map: loadTexture(data.tex),
                    roughness: 0.9 
                });
                const mesh = new THREE.Mesh(geo, mat);
                
                const pivot = new THREE.Object3D();
                pivot.add(mesh);
                scene.add(pivot);
                mesh.position.x = data.dist;

                // Lua da Terra
                if (data.hasMoon) {
                    const moonGeo = new THREE.SphereGeometry(data.size * 0.3, 32, 32); 
                    const moonMat = new THREE.MeshStandardMaterial({ map: loadTexture('moon') });
                    const moonMesh = new THREE.Mesh(moonGeo, moonMat);
                    const moonPivot = new THREE.Object3D();
                    
                    moonPivot.position.x = data.dist;
                    moonMesh.position.x = data.size * 5; 
                    
                    pivot.add(moonPivot); 
                    moonPivot.add(moonMesh);
                    planets.push({ mesh: moonMesh, pivot: moonPivot, speed: data.speed * 10 }); 
                }
                
                planets.push({ mesh: mesh, pivot: pivot, speed: data.speed });
            });
        }

        // --- MODO 2: MAPA MUNDI ---
        function createWorldMap() {
            camera.position.set(0, 0, 25);

            const dirLight = new THREE.DirectionalLight(0xffffff, 5); 
            dirLight.position.set(5, 3, 5);
            scene.add(dirLight);

            const ambientLight = new THREE.AmbientLight(0x888888); 
            scene.add(ambientLight);

            const geo = new THREE.SphereGeometry(10, 64, 64);
            const mat = new THREE.MeshStandardMaterial({ 
                map: loadTexture('worldMap'),
                roughness: 0.7, 
                metalness: 0.1 
            });
            const earth = new THREE.Mesh(geo, mat);
            scene.add(earth);

            // Background do Mapa Mundi usa o raio original para não ficar muito grande
            const starGeo = new THREE.SphereGeometry(100, 64, 64);
            const starMat = new THREE.MeshBasicMaterial({ map: loadTexture('stars'), side: THREE.BackSide });
            scene.add(new THREE.Mesh(starGeo, starMat));

            planets.push({ mesh: earth, pivot: null, speed: 0.005 });
        }

        // Loop de Animação
        function animate() {
            animationId = requestAnimationFrame(animate);
            controls.update();

            if (!isPaused) {
                planets.forEach(p => {
                    p.mesh.rotation.y += 0.005;
                    
                    if (p.pivot) {
                        p.pivot.rotation.y += p.speed;
                    }
                });
            }

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- LÓGICA DO MENU ---
        window.iniciarJogo = function(modo) {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('controls-container').style.display = 'flex';
            isPaused = false;
            document.getElementById('pause-btn').textContent = 'Pausar Rotação';

            if (!renderer) init();

            // Reseta a distância máxima de zoom para o modo correto
            if (modo === 'solar') {
                controls.maxDistance = STAR_SPHERE_RADIUS - 100;
            } else {
                 // Modo Mapa Mundi tem uma esfera de estrelas menor (raio 100)
                controls.maxDistance = 90;
            }

            while(scene.children.length > 0){ 
                scene.remove(scene.children[0]); 
            }
            planets = []; 

            if (modo === 'solar') {
                createSolarSystem();
            } else {
                createWorldMap();
            }
            
            toggleAudio(true); 
            animate();
        };

        window.voltarMenu = function() {
            cancelAnimationFrame(animationId);
            document.getElementById('main-menu').style.display = 'flex';
            document.getElementById('controls-container').style.display = 'none';
            
            toggleAudio(false); 
        }
    </script>
</body>
</html>
