<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Solar 3D & Mapa Mundi</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Estilo do Menu Principal */
        #main-menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10; color: white;
        }
        h1 { font-size: 3rem; text-transform: uppercase; letter-spacing: 5px; margin-bottom: 40px; text-shadow: 0 0 10px #4facfe; }
        
        .btn {
            padding: 15px 40px; margin: 10px; font-size: 1.5rem;
            background: transparent; color: white; border: 2px solid #4facfe;
            cursor: pointer; transition: 0.3s; border-radius: 30px; text-transform: uppercase;
            width: 300px;
        }
        .btn:hover { background: #4facfe; color: #000; box-shadow: 0 0 20px #4facfe; }

        /* Botão de Voltar */
        #back-btn {
            position: absolute; top: 20px; left: 20px;
            padding: 10px 20px; background: rgba(255, 0, 0, 0.7);
            color: white; border: none; cursor: pointer; display: none; z-index: 5;
        }
    </style>
</head>
<body>

    <audio id="ambient-music" loop muted></audio>
    
    <div id="main-menu">
        <h1>Cosmos Explorer</h1>
        <button class="btn" onclick="iniciarJogo('solar')">Jogar (Sistema Solar)</button>
        <button class="btn" onclick="iniciarJogo('mapa')">Mapa Mundi</button>
    </div>

    <button id="back-btn" onclick="voltarMenu()">Voltar ao Menu</button>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls;
        let animationId;
        let planets = []; 
        let audio; // Variável global para o elemento de áudio
        
        // --- CONFIGURAÇÃO DE CAMINHOS ---
        const REPO_NAME = 'Solar-System'; 
        
        // Função para construir o caminho de forma robusta
        function buildPath(folder) {
            const isGitHubPages = window.location.host.includes('github.io');
            if (isGitHubPages) {
                // Caminho absoluto para GitHub Pages: /NomeDoRepo/pasta/arquivo.ext
                return `/${REPO_NAME}/${folder}/`;
            } else {
                // Caminho relativo para testes locais: ./pasta/
                return `./${folder}/`;
            }
        }

        const texturePath = buildPath('textures'); 
        const AUDIO_FILE_PATH = buildPath('audio') + 'space_ambient.mp3'; 
        
        const textureLoader = new THREE.TextureLoader();

        const textureFiles = {
            stars: 'stars.jpg', sun: 'sun.jpg', mercury: 'mercury.jpg', venus: 'venus.jpg',
            earth: 'earth.jpg', moon: 'moon.jpg', mars: 'mars.jpg', jupiter: 'jupiter.jpg',
            saturn: 'saturn.jpg', uranus: 'uranus.jpg', neptune: 'neptune.jpg',
            worldMap: 'world_map_political.jpg' 
        };

        function loadTexture(name) {
            return textureLoader.load(
                texturePath + textureFiles[name], 
                undefined, 
                undefined, 
                (err) => console.warn(`Textura ${name} não encontrada. Usando cor padrão.`)
            );
        }

        // Inicialização básica (só acontece na primeira vez)
        function init() {
            const container = document.body;
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 10000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // Inicializa o elemento de áudio
            audio = document.getElementById('ambient-music');
            audio.src = AUDIO_FILE_PATH; // Define o caminho do GitHub/local

            window.addEventListener('resize', onWindowResize);
        }

        // --- FUNÇÃO DE ÁUDIO COM REPRODUÇÃO NO CLIQUE ---
        function toggleAudio(play) {
            if (!audio) return;

            if (play) {
                // Tenta reproduzir. Isso SÓ funciona porque o usuário clicou em 'Jogar'.
                audio.muted = false; 
                audio.volume = 0.4; // Volume baixo para ambientação
                audio.play().catch(e => {
                    // Se falhar, avisa no console (geralmente por problemas de caminho)
                    console.error("Não foi possível tocar o áudio. Verifique o caminho:", AUDIO_FILE_PATH);
                });
            } else {
                audio.pause();
            }
        }

        // --- MODO 1: SISTEMA SOLAR ---
        function createSolarSystem() {
            // ... (Configuração 3D do Sistema Solar) ...
            
            camera.position.set(0, 300, 500);
            
            const starGeo = new THREE.SphereGeometry(4000, 64, 64);
            const starMat = new THREE.MeshBasicMaterial({ map: loadTexture('stars'), side: THREE.BackSide });
            scene.add(new THREE.Mesh(starGeo, starMat));

            const sunGeo = new THREE.SphereGeometry(30, 64, 64);
            const sunMat = new THREE.MeshBasicMaterial({ map: loadTexture('sun') });
            const sun = new THREE.Mesh(sunGeo, sunMat);
            scene.add(sun);
            
            const sunLight = new THREE.PointLight(0xFFFFFF, 500, 5000); 
            sunLight.position.set(0, 0, 0); 
            scene.add(sunLight);

            const ambientLight = new THREE.AmbientLight(0x111111); 
            scene.add(ambientLight);

            const planetData = [
                { size: 0.5, dist: 150, speed: 0.04, tex: 'mercury', hasMoon: false },
                { size: 0.8, dist: 250, speed: 0.015, tex: 'venus', hasMoon: false },
                { size: 1.0, dist: 350, speed: 0.01, tex: 'earth', hasMoon: true },
                { size: 0.7, dist: 500, speed: 0.008, tex: 'mars', hasMoon: false },
                { size: 5.0, dist: 1000, speed: 0.002, tex: 'jupiter', hasMoon: false },
                { size: 4.5, dist: 1500, speed: 0.0009, tex: 'saturn', hasMoon: false }, 
                { size: 2.5, dist: 2000, speed: 0.0004, tex: 'uranus', hasMoon: false },
                { size: 2.5, dist: 2500, speed: 0.0001, tex: 'neptune', hasMoon: false }
            ];

            planetData.forEach(data => {
                const geo = new THREE.SphereGeometry(data.size, 32, 32);
                const mat = new THREE.MeshStandardMaterial({ map: loadTexture(data.tex) });
                const mesh = new THREE.Mesh(geo, mat);
                
                const pivot = new THREE.Object3D();
                pivot.add(mesh);
                scene.add(pivot);
                
                mesh.position.x = data.dist;

                // Lua da Terra
                if (data.hasMoon) {
                    const moonGeo = new THREE.SphereGeometry(data.size * 0.3, 32, 32); 
                    const moonMat = new THREE.MeshStandardMaterial({ map: loadTexture('moon') });
                    const moonMesh = new THREE.Mesh(moonGeo, moonMat);
                    
                    const moonPivot = new THREE.Object3D();
                    moonPivot.position.x = data.dist;
                    
                    moonMesh.position.x = data.size * 5; 
                    
                    pivot.add(moonPivot); 
                    moonPivot.add(moonMesh);
                    planets.push({ mesh: moonMesh, pivot: moonPivot, speed: data.speed * 10 }); 
                }
                
                planets.push({ mesh: mesh, pivot: pivot, speed: data.speed });
            });
        }

        // --- MODO 2: MAPA MUNDI ---
        function createWorldMap() {
            // ... (Configuração 3D do Mapa Mundi) ...
            
            camera.position.set(0, 0, 25);

            const dirLight = new THREE.DirectionalLight(0xffffff, 3); 
            dirLight.position.set(5, 3, 5);
            scene.add(dirLight);

            const ambientLight = new THREE.AmbientLight(0x444444);
            scene.add(ambientLight);

            const geo = new THREE.SphereGeometry(10, 64, 64);
            const mat = new THREE.MeshStandardMaterial({ 
                map: loadTexture('worldMap'),
                roughness: 0.7, 
                metalness: 0.1 
            });
            const earth = new THREE.Mesh(geo, mat);
            scene.add(earth);

            const starGeo = new THREE.SphereGeometry(100, 64, 64);
            const starMat = new THREE.MeshBasicMaterial({ map: loadTexture('stars'), side: THREE.BackSide });
            scene.add(new THREE.Mesh(starGeo, starMat));

            planets.push({ mesh: earth, pivot: null, speed: 0.005 });
        }

        // Loop de Animação
        function animate() {
            animationId = requestAnimationFrame(animate);
            controls.update();

            planets.forEach(p => {
                p.mesh.rotation.y += 0.005;
                
                if (p.pivot) {
                    p.pivot.rotation.y += p.speed;
                }
            });

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- LÓGICA DO MENU ---
        window.iniciarJogo = function(modo) {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('back-btn').style.display = 'block';

            if (!renderer) init();

            while(scene.children.length > 0){ 
                scene.remove(scene.children[0]); 
            }
            planets = []; 

            if (modo === 'solar') {
                createSolarSystem();
            } else {
                createWorldMap();
            }
            
            // INICIA O ÁUDIO AQUI
            toggleAudio(true); 

            animate();
        };

        window.voltarMenu = function() {
            cancelAnimationFrame(animationId);
            document.getElementById('main-menu').style.display = 'flex';
            document.getElementById('back-btn').style.display = 'none';
            
            // PAUSA O ÁUDIO AO VOLTAR
            toggleAudio(false); 
        }
    </script>
</body>
</html>
